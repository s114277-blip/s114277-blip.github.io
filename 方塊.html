<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>可點擊高挑戰版</title>
<style>
body { background:#333; margin:0; display:flex; flex-direction:column; justify-content:center; align-items:center; height:100vh; font-family:Arial; color:white;}
#game{width:400px; height:400px; background:black; position:relative; border:3px solid white; margin-bottom:10px;}
.box{width:50px; height:50px; position:absolute; cursor:pointer; border-radius:5px;}
#score,#time{font-size:20px;margin:5px;}
</style>
</head>
<body>
<div id="game"></div>
<div id="score">分數：0</div>
<div id="time">剩餘時間：30 秒</div>

<script>
let game=document.getElementById("game");
let scoreDisplay=document.getElementById("score");
let timeDisplay=document.getElementById("time");

let score=0;
let totalTime=30;
let speed=1000;
let minSpeed=300;
let boxes=[];
let timer;

// 顏色隨機
function randomColor(){
    let r=Math.random();
    if(r<0.6)return "red";
    if(r<0.85)return "yellow";
    return "blue";
}

// 創建方塊
function createBox(){
    let box=document.createElement("div");
    box.classList.add("box");
    box.style.background=randomColor();
    box.clicked=false;

    box.onclick=function(){
        box.clicked=true;
        if(box.style.background==="red") score+=Math.round(1000/speed);
        else if(box.style.background==="yellow") score+=Math.round(2000/speed);
        else if(box.style.background==="blue") score=Math.max(0,score-1);
        scoreDisplay.textContent="分數："+score;
        speed=Math.max(minSpeed,speed-20);
    };

    game.appendChild(box);
    boxes.push(box);
}

// 移動所有方塊（統一控制，保證可點）
function moveBoxes(){
    boxes.forEach(box=>{
        if(!box.clicked && (box.style.background==="red" || box.style.background==="yellow")){
            score=Math.max(0,score-1);
            scoreDisplay.textContent="分數："+score;
        }
        box.clicked=false;
        box.style.background=randomColor();
        let maxX=game.clientWidth-box.offsetWidth;
        let maxY=game.clientHeight-box.offsetHeight;
        box.style.left=Math.random()*maxX+"px";
        box.style.top=Math.random()*maxY+"px";
    });
}

// 倒數計時
function startTimer(){
    timer=setInterval(()=>{
        totalTime--;
        timeDisplay.textContent="剩餘時間："+totalTime+" 秒";
        if(totalTime<=0){
            clearInterval(timer);
            clearInterval(loop);
            boxes.forEach(b=>b.remove());
            alert("遊戲結束！你的分數："+score);
            score=0; totalTime=30; speed=1000;
            scoreDisplay.textContent="分數：0";
            timeDisplay.textContent="剩餘時間：30 秒";
            startGame();
        }
    },1000);
}

function startGame(){
    boxes.forEach(b=>b.remove());
    boxes=[];
    for(let i=0;i<3;i++) createBox();
    loop=setInterval(()=>{
        moveBoxes();
    },speed);
}

startGame();
startTimer();
</script>
</body>
</html>
